{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Design document artifact",
  "description": "Output of /design phase: first-principles design grounded in validated truths.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "analysis",
    "constraints_classification",
    "approach",
    "research",
    "codebase_alignment",
    "iteration_history"
  ],
  "properties": {
    "analysis": {
      "type": "object",
      "additionalProperties": false,
      "required": ["summary", "principles"],
      "properties": {
        "summary": { "type": "string", "minLength": 1 },
        "principles": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["principle", "implication"],
            "properties": {
              "principle": { "type": "string", "minLength": 1 },
              "implication": { "type": "string", "minLength": 1 }
            }
          }
        }
      }
    },
    "constraints_classification": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["constraint", "original_type", "validated_type", "evaluation"],
        "properties": {
          "constraint": { "type": "string", "minLength": 1 },
          "original_type": { "type": "string", "enum": ["hard", "soft"] },
          "validated_type": { "type": "string", "enum": ["hard", "soft"] },
          "evaluation": { "type": "string", "minLength": 1 },
          "flagged": {
            "type": "boolean",
            "description": "True when a soft constraint was incorrectly treated as hard."
          }
        }
      }
    },
    "approach": {
      "type": "object",
      "additionalProperties": false,
      "required": ["description", "rationale"],
      "properties": {
        "description": { "type": "string", "minLength": 1 },
        "rationale": { "type": "string", "minLength": 1 },
        "components": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["name", "responsibility"],
            "properties": {
              "name": { "type": "string", "minLength": 1 },
              "responsibility": { "type": "string", "minLength": 1 },
              "interfaces": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          }
        }
      }
    },
    "research": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["source", "finding", "verified_at"],
        "properties": {
          "source": { "type": "string", "minLength": 1 },
          "url": { "type": "string", "format": "uri" },
          "finding": { "type": "string", "minLength": 1 },
          "verified_at": { "type": "string", "format": "date-time" }
        }
      }
    },
    "codebase_alignment": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["pattern", "alignment_status"],
        "properties": {
          "pattern": { "type": "string", "minLength": 1 },
          "file_paths": {
            "type": "array",
            "items": { "type": "string" }
          },
          "alignment_status": {
            "type": "string",
            "enum": ["aligned", "divergent", "new"]
          },
          "notes": { "type": "string" }
        }
      }
    },
    "iteration_history": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["iteration", "changes", "rationale"],
        "properties": {
          "iteration": { "type": "integer", "minimum": 1 },
          "changes": { "type": "string", "minLength": 1 },
          "rationale": { "type": "string", "minLength": 1 }
        }
      }
    }
  }
}
