{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Execution plan artifact",
  "description": "Output of /plan phase: atomic task groups so specific that build agents never ask clarifying questions.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "task_groups",
    "file_ownership",
    "verification_commands"
  ],
  "properties": {
    "task_groups": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["group_id", "tasks"],
        "properties": {
          "group_id": { "type": "string", "minLength": 1 },
          "builder_tier": {
            "type": "string",
            "enum": ["high_reasoning", "fast"],
            "default": "fast",
            "description": "Capability tier used for execution assignment."
          },
          "scope_override": {
            "type": "object",
            "additionalProperties": false,
            "required": ["reason"],
            "properties": {
              "reason": { "type": "string", "minLength": 1 }
            },
            "description": "Required when the planner intentionally deviates from the 3-6 task target for this group."
          },
          "tasks": {
            "type": "array",
            "minItems": 1,
            "maxItems": 8,
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "id",
                "description",
                "file_paths",
                "code_patterns",
                "test_cases",
                "acceptance_criteria"
              ],
              "properties": {
                "id": { "type": "string", "minLength": 1 },
                "description": { "type": "string", "minLength": 1 },
                "file_paths": {
                  "type": "array",
                  "items": { "type": "string" },
                  "minItems": 1
                },
                "code_patterns": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["file", "pattern"],
                    "properties": {
                      "file": { "type": "string", "minLength": 1 },
                      "pattern": { "type": "string", "minLength": 1 },
                      "description": { "type": "string" }
                    }
                  },
                  "minItems": 1
                },
                "test_cases": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["name", "setup", "assertion", "expected"],
                    "properties": {
                      "name": { "type": "string", "minLength": 1 },
                      "setup": { "type": "string", "minLength": 1 },
                      "assertion": { "type": "string", "minLength": 1 },
                      "expected": { "type": "string", "minLength": 1 }
                    }
                  },
                  "minItems": 1
                },
                "acceptance_criteria": {
                  "type": "array",
                  "items": { "type": "string", "minLength": 1 },
                  "minItems": 1
                },
                "dependencies": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Task IDs this task depends on (within the same group)."
                }
              }
            }
          }
        }
      }
    },
    "file_ownership": {
      "type": "object",
      "additionalProperties": { "type": "string" },
      "description": "Map of file_path -> group_id. No file may appear in more than one group."
    },
    "verification_commands": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["command", "description"],
        "properties": {
          "command": { "type": "string", "minLength": 1 },
          "description": { "type": "string", "minLength": 1 },
          "working_directory": { "type": "string" }
        }
      },
      "minItems": 1
    }
  }
}
