{
  "project": "Ralph Audit — coding-agents-space",
  "branchName": "main",
  "description": "Read-only audit of agent tooling repo: runtime skills (ts-optimize, ps1-optimize), contracts, playbook skills, agent-config, scripts. Document broken logic, unfinished features, code slop, dead ends, stubs, schema/contract drift, and sandbox/safety issues. Output to .codex/ralph-audit/audit/*.md",
  "verificationCommands": {
    "typecheck": "echo 'Audit mode - no verification'",
    "lint": "echo 'Audit mode - no verification'",
    "test": "echo 'Audit mode - no verification'"
  },
  "userStories": [
    {
      "id": "AUDIT-001",
      "title": "Shared Contracts & Schemas Deep Audit",
      "description": "Exhaustively audit contracts/ and all *\.schema.json for consistency, correctness, and drift.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/01-contracts.md with ALL findings",
        "Every schema and contract file examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 1,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read: contracts/skill-manifest.schema.json, contracts/tool-definition.schema.json, contracts/run-result.schema.json, contracts/permissions.schema.json. Also skills/dev-tools/ts-optimize/schemas/input.schema.json, output.schema.json; skills/dev-tools/ps1-optimize/schemas/input.schema.json, output.schema.json. Look for: $ref that don't resolve, required vs optional mismatches, additionalProperties inconsistencies, types that don't match runtime output, schema drift between contracts and skill schemas, invalid JSON Schema (draft 2020-12), duplicate definitions, missing descriptions, enums that don't match code. Produce full markdown for .codex/ralph-audit/audit/01-contracts.md."
    },
    {
      "id": "AUDIT-002",
      "title": "ts-optimize Runtime Skill Deep Audit",
      "description": "Exhaustively audit skills/dev-tools/ts-optimize for ALL problems.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/02-ts-optimize.md with ALL findings",
        "Every TS/file examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 2,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read every file under skills/dev-tools/ts-optimize: src/node/index.ts, src/node/lib/*.ts, src/node/types/*.ts, schemas/*.json, manifest.yaml, package.json, tsconfig.json, sandbox/Dockerfile, sandbox/permissions.yaml, tests/unit/*.ts, tests/integration/*.ts. Look for: broken logic, TODO/FIXME, stub returns, wrong return shape vs output schema, missing error handling, path handling that could escape /workspace, magic numbers, unused exports, dead code, inconsistent patterns with ps1-optimize, promises without catch, unvalidated input against schema, patches that could write outside project root. Produce full markdown for .codex/ralph-audit/audit/02-ts-optimize.md."
    },
    {
      "id": "AUDIT-003",
      "title": "ps1-optimize Runtime Skill Deep Audit",
      "description": "Exhaustively audit skills/dev-tools/ps1-optimize for ALL problems.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/03-ps1-optimize.md with ALL findings",
        "Every TS/file examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 3,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read every file under skills/dev-tools/ps1-optimize: src/node/index.ts, src/node/lib/*.ts, schemas, manifest.yaml, package.json, sandbox/*, tests/*. Same categories as ts-optimize: broken logic, stubs, schema mismatch, path safety, error handling, dead code, consistency with ts-optimize. Produce full markdown for .codex/ralph-audit/audit/03-ps1-optimize.md."
    },
    {
      "id": "AUDIT-004",
      "title": "Agent Config & Tool Definitions Audit",
      "description": "Exhaustively audit agent-config/ and tool definition wiring.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/04-agent-config.md with ALL findings",
        "All config files examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 4,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read: agent-config/tool-definitions/tools.generated.json, agent-config/tool-definitions/README.md, agent-config/constraints.yaml. Check: $ref paths resolve from repo root (or documented base), tool names match runner expectations, no stale tool refs, schema refs point to existing files, description vs manifest consistency, duplicate tool names. Produce full markdown for .codex/ralph-audit/audit/04-agent-config.md."
    },
    {
      "id": "AUDIT-005",
      "title": "Playbook Skills (Type SKILLs) Audit",
      "description": "Exhaustively audit .codex/skills type folders for consistency and correctness.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/05-playbook-skills.md with ALL findings",
        "Every SKILL.md and config examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 5,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read .codex/skills/*/SKILL.md (core, repo, code, containers, k8s, pve, host, network, edge, ops, security, frontend, research, music, llm). Check: frontmatter name matches directory name, description 1-1024 chars, no deep refs (assets/foo/bar), prompt→config tables complete, config names match referenced areas, broken internal links, inconsistent severity/format, SKILL.md over 500 lines (validator limit), missing config for a listed type. Produce full markdown for .codex/ralph-audit/audit/05-playbook-skills.md."
    },
    {
      "id": "AUDIT-006",
      "title": "Scripts & CI Deep Audit",
      "description": "Exhaustively audit scripts/ and .github/workflows for ALL problems.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/06-scripts-ci.md with ALL findings",
        "Every script and workflow examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 6,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read: scripts/verify.sh, scripts/ci-local.sh, scripts/codex/validate_skills.py, .github/workflows/ci.yml, .github/workflows/security.yml. Look for: broken paths, wrong assumptions about repo layout, sed/awk portability (macOS vs Linux), missing error handling, credentials in logs, insecure use of env vars, CI steps that don't match local verify, duplicate or dead steps, validator logic bugs (frontmatter, line count, deep ref regex). Produce full markdown for .codex/ralph-audit/audit/06-scripts-ci.md."
    },
    {
      "id": "AUDIT-007",
      "title": "Sandbox & Permissions Audit",
      "description": "Exhaustively audit sandbox config and permissions for safety.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/07-sandbox.md with ALL findings",
        "All sandbox and permission files examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 7,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read: skills/dev-tools/ts-optimize/sandbox/Dockerfile, permissions.yaml; skills/dev-tools/ps1-optimize/sandbox/Dockerfile, permissions.yaml. contracts/permissions.schema.json. Look for: running as root, unnecessary capabilities, network allowed when not needed, write paths outside /workspace, permission rules that could allow escape, Dockerfile layers that leak secrets, base image pinning, inconsistent permissions between ts-optimize and ps1-optimize. Produce full markdown for .codex/ralph-audit/audit/07-sandbox.md."
    },
    {
      "id": "AUDIT-008",
      "title": "Runtime Skill Tests Audit",
      "description": "Exhaustively audit unit and integration tests for runtime skills.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/08-runtime-tests.md with ALL findings",
        "All test files examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 8,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read: skills/dev-tools/ts-optimize/tests/unit/*.ts, tests/integration/*.ts; skills/dev-tools/ps1-optimize/tests/unit/*.ts, tests/integration/*.ts. Look for: tests that always pass (no real assertions), skipped tests, tests that test implementation not behavior, missing tests for critical paths (e.g. path escaping, output shape), mocks that don't match real code, flaky patterns, hardcoded paths that break on other machines. Produce full markdown for .codex/ralph-audit/audit/08-runtime-tests.md."
    },
    {
      "id": "AUDIT-009",
      "title": "Manifests & Package Config Audit",
      "description": "Exhaustively audit manifest.yaml and package.json files for consistency.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/09-manifests-packages.md with ALL findings",
        "All manifest and package files examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 9,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read: skills/dev-tools/ts-optimize/manifest.yaml, package.json, package-lock.json; skills/dev-tools/ps1-optimize/manifest.yaml, package.json, package-lock.json. contracts/skill-manifest.schema.json. Look for: manifest not validating against skill-manifest schema, version drift, script names that don't exist, missing engine/node version, duplicate or conflicting deps, unpinned or overly broad versions, private vs published confusion. Produce full markdown for .codex/ralph-audit/audit/09-manifests-packages.md."
    },
    {
      "id": "AUDIT-010",
      "title": "Docs & README Audit",
      "description": "Exhaustively audit docs and README files for accuracy and broken refs.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/10-docs.md with ALL findings",
        "All doc files examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 10,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read: README.md, AGENTS.md, docs/skill-template.md, docs/ci.md, docs/RUNBOOK.md, docs/REPO_MAP.md, .codex/skills/README.md, agents/dev-tools/README.md, skills/dev-tools/ts-optimize/README.md, skills/dev-tools/ps1-optimize/README.md, agent-config/tool-definitions/README.md. Look for: broken links, outdated paths (e.g. old skill names), wrong commands, docs that contradict code, missing docs for public contract. Produce full markdown for .codex/ralph-audit/audit/10-docs.md."
    },
    {
      "id": "AUDIT-011",
      "title": "TypeScript Types & Interfaces Audit",
      "description": "Exhaustively audit TypeScript types for correctness and consistency.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/11-types.md with ALL findings",
        "All type definitions examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 11,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Search skills/dev-tools/*/src for types, interfaces, type aliases. Look for: types that don't match JSON schema or runtime output, any/unknown overuse, wrong nullability, duplicated types across packages, types referencing removed symbols, types that would cause runtime errors. Produce full markdown for .codex/ralph-audit/audit/11-types.md."
    },
    {
      "id": "AUDIT-012",
      "title": "Error Handling & Edge Cases Audit",
      "description": "Exhaustively audit error handling and edge cases in runtime code.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/12-error-handling.md with ALL findings",
        "All error handling examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 12,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Search skills/dev-tools/*/src for try/catch, .catch(), throw, error objects. Look for: swallowed errors, unhelpful messages, missing handling for fs/network/parse failures, error shape not matching run-result.schema.json error field. Produce full markdown for .codex/ralph-audit/audit/12-error-handling.md."
    },
    {
      "id": "AUDIT-013",
      "title": "Dead Code & Unused Exports Audit",
      "description": "Exhaustively find dead code and unused exports in runtime skills.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/13-dead-code.md with ALL findings",
        "Codebase scanned for unused exports, orphan files, unreachable code; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 13,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Scan skills/dev-tools/*/src for: exports never imported, files never imported, code after return, always-true/false conditions, unused parameters. Produce full markdown for .codex/ralph-audit/audit/13-dead-code.md."
    },
    {
      "id": "AUDIT-014",
      "title": "Examples & Fixtures Audit",
      "description": "Exhaustively audit examples and expected-output fixtures for validity.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/14-examples.md with ALL findings",
        "All example and fixture files examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 14,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read: skills/dev-tools/ts-optimize/examples/*.json, expected-output.example.json; skills/dev-tools/ps1-optimize/examples/*.json, expected-output.example.json. Check: valid against input schema, expected output matches output schema, paths and options realistic, no placeholder or lorem data that would mislead. Produce full markdown for .codex/ralph-audit/audit/14-examples.md."
    },
    {
      "id": "AUDIT-015",
      "title": "Ralph Audit Loop & Codex Config Self-Audit",
      "description": "Exhaustively audit .codex/ralph-audit and Codex-related config for consistency.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/15-ralph-self.md with ALL findings",
        "ralph-audit and related config examined; each finding has path, line numbers, severity, description, code snippet"
      ],
      "priority": 15,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read: .codex/ralph-audit/prd.json, .codex/ralph-audit/CODEX.md, .codex/ralph-audit/ralph.sh, .codex/ralph-audit/README.md, .codex/ralph-audit/progress.txt. Check: prd acceptanceCriteria output paths exist and match script expectations, story ids and priorities consistent, CODEX.md severity/rules aligned with repo, ralph.sh REPO_ROOT and sed usage (macOS), security check env vars relevant to this repo. Produce full markdown for .codex/ralph-audit/audit/15-ralph-self.md."
    },
    {
      "id": "AUDIT-016",
      "title": "Final Consolidation & Index",
      "description": "Create master index of all findings and summary statistics.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/00-INDEX.md with summary of all findings",
        "Total counts by severity; top 10 critical findings; list of all audit files with counts"
      ],
      "priority": 16,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read all .codex/ralph-audit/audit/*.md from previous steps. Create 00-INDEX.md with: executive summary, total findings, breakdown by severity and category, top 10 critical findings, table of contents linking to each audit file. Documentation only."
    }
  ]
}
